<!doctype html>
<html>
<head>
	<title>Vokabel-Wartung</title>
	<meta charset="utf-8">
	<script src="jquery-3.2.1.min.js"></script>
	<script src="/jquery-ui-1.12.1/jquery-ui.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="jquery-ui-1.12.1/jquery-ui.css">
	<link rel="stylesheet" href="style.css" >
	<script>
	$( function() {
    $( "#accordion" ).accordion({
			heightStyle: 'content',
			header: "h3"
		});
  } );

	var meineLanguagesArray = [];

	var erzeugeTabelle = function() {
		$( '#vokabeltab' ).empty();
		$( '<tr id="tableheader">' ).appendTo( '#vokabeltab' );

		for (i in meineLanguagesArray){
			$('<th>')
				.appendTo( 'tr' )
				.html( meineLanguagesArray[i].name );
			$( '<td contenteditable>' ) // erste Zeile leer für neue Vokabel
				.appendTo( '#vokabeltab' )
				.attr('data-id',0)
				.attr('data-language',meineLanguagesArray[i].language)
				.html(meineLanguagesArray[i].name);
		}


		$.ajax({
			url:'http://localhost:5000/vokabel',
			method:'GET',
			success:function(data){
				var alle = data.vokabel;

				for (i in alle) {
					$( '<tr>' ).appendTo( '#vokabeltab' );
					for (j in alle[i]) {
						if (j != 'id') {
							$( '<td contenteditable>' )
								.appendTo( '#vokabeltab' )
								.attr('data-id', alle[i].id)
								.attr('data-language',alle[i][j])
								.html( alle[i][j] );
						}else {
							var satznummer = alle[i].id;
							console.log('ALLE: ', alle, alle[i].id, satznummer);
							var button_del = $( '<button>' ).html( 'Löschen' ).attr('data-nr',alle[i]);
							button_del.on( 'click', function() {
								var i = $(this).attr('data-nr', j); // id aus DatenbankTabelle
								$.ajax({
									url:'http://localhost:5000/vokabel/delete',
									method:'POST',
									data:{ 'id': satznummer },
									success:function(){
										alert( 'weg ist' );
										erzeugeTabelle();
									}
								});//ajax
							});//button.onclick
							var button_sav = $( '<button>' ).html( 'Speichern' ).attr('data-nr',satznummer);
							button_sav.on( 'click', function() {
								var i = $(this).attr('data-nr', satznummer); // id aus DatenbankTabelle

								console.log('Vokabel: ',$('td').attr('data-id')); // hier weiter - (this).attr('data-nr') rowId, (td mit = rowId).html() sollte der Inhalt sein (hoffentlich)
								$.ajax({
									url:'http://localhost:5000/vokabel/insert',
									method:'POST',
									data:{ 'id': satznummer },
									success:function(){
										alert( 'gespeichert ist' );
										erzeugeTabelle();
									}
								});//ajax
							});//button.onclick
						} // else

					}
					$( '<td>' )
						.appendTo( '#vokabeltab' )
						.append( button_sav )
						.append( button_del );
				}
			}
		});//ajax
	};  // erzeuge Tabelle


	function insertSprache() {
		var language = $('#alleSprachen option:selected').val();
		var name = $('#alleSprachen option:selected').text();
		var vorhanden = false;
		for (var i = 0; i < meineLanguagesArray.length; i++) {
			console.log(meineLanguagesArray);
			if (meineLanguagesArray[i].language==language) {vorhanden=true};
		}
		if (vorhanden) {
			alert('Geht nimmer - gibts schon');
		}else{
			$.ajax({
				url:'http://localhost:5000/sprachen/insert',
				method:'POST',
				data:{ 'language': language,
							 'name': name},
				success:function( responseVomServer ) {
					console.log( responseVomServer );
					meineLanguages();
				}
			}); //ajax
		}; // else
	}

	function deleteSprache() {
		var language = $('#meineSprachen option:selected').val();
		var name = $('#meineSprachen option:selected').text();
		$.ajax({
			url:'http://localhost:5000/sprachen/delete',
			method:'POST',
			data:{ 'language': language,
						 'name': name},
			success:function( responseVomServer ) {
				console.log( responseVomServer );
				meineLanguages();
			}
		}); //ajax
	}

	function meineLanguages()
	  {
	    $('#meineSprachen').empty();
			meineLanguagesArray.splice(0, meineLanguagesArray.length);
	    $.ajax({
          type: "GET",
					async: false,
          url:'http://localhost:5000/sprachen',
          success: function(data){
						for (var i = 0; i < data.sprachen.length; i++) {
							meineLanguagesArray.push( {language:data.sprachen[i].language, name:data.sprachen[i].name });
							//console.log('Meine Languages Array: ', meineLanguagesArray);
							$('#meineSprachen').append('<option value="' + data.sprachen[i].language + '">' + data.sprachen[i].name + '</option>');
						}
        	}
      });

		erzeugeTabelle();
	  };

		function alleLanguages()
		  {
		    $('#alleSprachen').empty();
		    $.ajax({
	          type: "GET",
	          url:'https://translation.googleapis.com/language/translate/v2/languages?target=de&key=AIzaSyASqd0scuK0zyyNo71oZ-UiFRd5W7CF5n0',
	          success: function(data){

	            $.each(data, function(i, d) {
								for (var i = 0; i < d.languages.length; i++) {
									//console.log(d.languages[i].language);
									$('#alleSprachen').append('<option value="' + d.languages[i].language + '">' + d.languages[i].name + '</option>');
								}

	          	});
	        	}
	      });
		  };

	$( document ).ready( function() {
		alleLanguages();
		meineLanguages();

		$( document ).on('click', '#btn-insert-language', function(event) {
			event.preventDefault();
			insertSprache();
		}); // on click

		$( document ).on('click', '#btn-delete-language', function(event) {
			event.preventDefault();
			deleteSprache();
		}); // on click


	});

$( document ).on( 'click', '#btn-auswahl', function() {
	window.open('/','_self').value;

});
	</script>
	<style>
	</style>
</head>
<body>
	<div>
		<h1>Vokabel - Wartung</h1></div>
		<div id="accordion">

			<h3>Sprachen - Settings</h3>
			<div>
				<p>
					Neue Sprache anlegen: <select id="alleSprachen"></select>
					<button id="btn-insert-language">Speichern</button>
					</br>
					Vorhandene Sprachen: <select id="meineSprachen"></select>
					<button id="btn-delete-language">Löschen</button>
				</br><hr>
				</p>
			</div>
			<h3>Gespeicherte Vokabel</h3>
			<div>
				<p>
					<table class="table table-hover" id="vokabeltab" border="1">
					</table>
				</p>
			</div>
		</div>
	<button id="btn-auswahl">Home</button>
</div>
</body>
</html>
